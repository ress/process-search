@(algorithms: Set[String])

<html>
<head profile="http://purl.org/NET/erdf/profile">
    <title>Process Search</title>

    <!-- libraries -->
    <script src="editor/gadget/console.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor/oryx/editor/lib/prototype-1.5.1.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/lib/path_parser.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/lib/ext-2.0.2/adapter/ext/ext-base.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/lib/ext-2.0.2/ext-all.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/lib/ext-2.0.2/color-field.js" type="text/javascript"></script>
    <!--<script src="jquery-1.8.3.min.js"></script>-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery.noConflict();
    </script>

    <script src="editor/oryx/editor/lib/jquery-ui-1.8.1.custom/js/jquery-ui-1.8.1.custom.min.js"></script>

    <style media="screen" type="text/css">
        @@import url("editor/oryx/editor/lib/ext-2.0.2/resources/css/ext-all.css");
        @@import url("editor/oryx/editor/lib/ext-2.0.2/resources/css/xtheme-gray.css");
        @@import url("editor/oryx/editor/lib/jquery-ui-1.8.1.custom/css/ui-lightness/jquery-ui-1.8.1.custom.css");
    </style>

    <!-- oryx editor -->
    <script src="editor/oryx/editor/data/i18n/translation_en_us.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/utils.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/kickstart.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/erdfparser.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/clazz.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/config.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/oryx.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/editpathhandler.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/minmaxpathhandler.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/pointspathhandler.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/svgmarker.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/svgshape.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/SVG/label.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/Math/math.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/stencil.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/property.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/propertyitem.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/complexpropertyitem.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/rules.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/stencilset.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/StencilSet/stencilsets.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/bounds.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/uiobject.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/abstractshape.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/canvas.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/main.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/svgDrag.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/shape.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/Controls/control.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/Controls/docker.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/Controls/magnet.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/node.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/edge.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/command.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/abstractPlugin.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/abstractLayouter.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Core/abstractcommand.js" type="text/javascript"></script>

    <script src="editor/oryx/editor/client/scripts/Plugins/sideTabs.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/addDocker.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/arrangementLight.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/canvasResize.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/dragDocker.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/dragdropresize.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/edit.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/keysMove.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/overlay.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/renameShapes.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/selectionframe.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/shapeHighlighting.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/shapemenu.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/toolbar.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/waveGlobalUndo.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/view.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/bpmn2.0.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/uml.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/wave.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/farbrausch.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/farbrausch_shadow.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/farbrausch_afterglow.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/farbrausch_legend.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/shapeTooltip.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/propertytab.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/syncro.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/syncroOryx.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/paint.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/changelog.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/newshaperepository.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/dockerCreation.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/schlaumeier.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/json_export.js" type="text/javascript"></script>
    <script src="editor/oryx/editor/client/scripts/Plugins/external_interface.js" type="text/javascript"></script>

    <!-- oryx editor -->
    <link rel="Stylesheet" media="screen" href="editor/oryx/editor/css/theme_norm.css" type="text/css" />

    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>

    <!-- FontAwesome -->
    <link href="editor/gadget/fontawesome/font-awesome.min.css" rel="stylesheet" />

    <!-- D3 and dagre -->
    <script type="text/javascript" src="/assets/javascripts/d3.js"></script>
    <script type="text/javascript" src="/assets/javascripts/dagre.js"></script>

    <!-- Handlebars -->
    <script type="text/javascript" src="/assets/javascripts/handlebars.js"></script>

    <!-- Processgraph -->
    <script type="text/javascript" src="/assets/javascripts/processgraph.js"></script>

    <style type="text/css">
        .result {
            margin: 20px
        }

        .graph {
            border: 1px solid black;
            width: 600px;
            height: 400px;
        }
        .graph text {
        font: 300 16px "Helvetica Neue";
        }

        .graph rect {
        fill: #fff;
        }

        .graph circle {
        stroke: #000;
        fill: #fff;
        }

        .node > rect {
        stroke-width: 3px;
        stroke: #333;
        fill: none;
        }

        .label > rect {
        fill: none;
        }

        .node:hover {
        cursor: pointer;
        opacity: 0.4;
        }

        .edge rect {
        fill: #fff
        }

        .edge path {
        fill: none;
        stroke: #333;
        stroke-width: 1.5px;
        }

        .edge:hover {
        cursor: pointer;
        opacity: 0.4;
        }
    </style>

    <script id="results-template" type="text/x-handlebars-template">
        {{#each models}}
        <div class="result">
            <h2>{{ filename }}</h2>
            <p>Distance: {{ score }}</p>
            <div class="dot" style="display: none">
                {{ dot }}
            </div>
            <svg class="graph" id="graph-{{ @@index }}"></svg>
        </div>
        {{/each}}
     </script>
</head>

<body style="text-align: center;">
    <h1>Process Search</h1>
    <div id="oryx-canvas" style="width: 700px; margin: auto; padding: 15px; height: 400px; "></div>
    <div id="error" style="color: red">&nbsp;</div>
    <div id="success" style="color: green">&nbsp;</div>
    <p>
    Available algorithms:<br />
    @for(algorithm <- algorithms) {
        <label>
            <input type="radio" name="algorithm" value="@algorithm" checked="checked" /> @algorithm<br />
        </label>
    }
    </p>
    <button id="search" class="btn btn-large btn-primary"><i class="icon-search"></i> Search</button>

    <div id="results"></div>

    <script type='text/javascript'>
        jQuery("#search").click(function() {
            // Show progress to user
            jQuery("#search i").attr('class', 'icon-spinner icon-spin');
            jQuery("#search").attr('disabled', true);
            jQuery("#error").html('&nbsp;');
            jQuery("#success").html('&nbsp;');

            var model = window.ORYXEditor.getSerializedJSON();
            var params = {
                algorithm: jQuery("input[name=algorithm]:checked").val(),
                json: model
            };

            var searchRequest = jQuery.ajax({
                url: "/search",
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(params)
            });

            searchRequest.fail(function(jqXHR, textStatus, exception) {
                jQuery("#search i").attr('class', 'icon-search');
                jQuery("#search").attr('disabled', false);
                jQuery("#error").html('There has been an error: ' + textStatus);
            });

            searchRequest.done(function(data) {
                jQuery("#search i").attr('class', 'icon-search');
                jQuery("#search").attr('disabled', false);
                jQuery("#success").html(data.message);
                jQuery("#success").html(jQuery("#success").html() + " " + data.models.join(', '));
                //if (data.models.length > 0) {
                //    var canvas = new Canviz("canviz", "/assets/xdot/" + data.models[0]);
                //}

                var template = Handlebars.compile(jQuery("#results-template").html())
                jQuery("#results").html(template(data));

                for (var i = 0; i < data.models.length; i++) {
                    new PetriNetGraph(data.models[i].dot, "#graph-" + i);
                }
            });
        });
    </script>

    <script type='text/javascript'>
        var stencilSetName = _getStencilSetName();

        function onOryxResourcesLoaded(){
            window.ORYXEditor = new ORYX.Editor({
                'id': 'oryx-canvas',
                'stencilset': {
                    'url': ORYX.CONFIG.ROOT_PATH + 'editor/data/stencilsets/' + stencilSetName + '/' + stencilSetName + '.json'
                },
                'fullscreen': false
            });
        }

        function _getStencilSetName() {
            if (stencilSetName) {
                return stencilSetName;
            }

            stencilSetName = "bpmn-search";
            var urlquery = location.href.split("?");
            if (urlquery[1]) {
                var urlterms = urlquery[1].split(",");
                for (var i = 0; i < urlterms.length; i++) {
                    if (urlterms[i].indexOf("stencilSetName=") == 0) {
                        stencilSetName = urlterms[i].slice("stencilSetName=".length);
                        break;
                    }
                }
            }

            return stencilSetName;
        }
    </script>
</body>
</html>
